<br>
<br>

<div class="espacio">
  <div *ngIf="(ErrorMessage != null || ErrorMessage != undefined )" class="alert alert-danger" id="danger">
    <strong>{{ErrorMessage}}</strong>
  </div>
  <div *ngIf="anadeNota != null" class=" alert alert-success">
    {{anadeNota}}
  </div>
</div>

<div class="row" id="infopro" *ngIf="MostrarInfo">

  <div class="col-xs-12 col-sm-5 col-md-5">
    Usuario: {{UserName}}
  </div>
  <div class="col-xs-12 col-sm-5 col-md-5">
    <span *ngIf="Project.fecha!=null">Fecha: {{ Project.fecha | date:'dd/MM/yyyy' }}</span>
  </div>

  <div class="col-xs-12 col-sm-5 col-md-5">

    <div class="form-horizontal">
      <div class="form-group">
        <label for="sel1" *ngIf="Project.fecha!=null">Proyecto: {{Project.nombre}}</label>
        <label for="sel1" *ngIf="Project.fecha==null">Proyecto: Todos</label>
      </div>
    </div>

  </div>
</div>
<br>


<div class="container">

  <div class="row">
    <div class="col-xs-12 col-sm-2 col-md-3"></div>
    <div class="col-xs-12 col-sm-8 col-md-6">
      <h2>Evaluaciones anteriores</h2>
    </div>
    <div class="col-xs-12 col-sm-2 col-md-3"></div>
  </div>
  <div [ngClass]="('' + (!Mostrar ? 'disabled' : ''))">
    <div class="row">
      <div class="panel panel-primary filterable">
        <div class="panel-heading">
          <div class="loading" *ngIf="!Mostrar">
            <app-loading></app-loading>
          </div>
          <div class="pull-right">
            <button class="btn btn-default btn-xs btn-filter" (click)="Restablecer()">Filtros</button>

            <label class="radio" *ngIf="clicked" (click)="ChangeFiltro(null)">
              <input name="radio" type="radio" checked>
              <span>Todas</span>
            </label>

            <label class="radio" *ngIf="clicked" (click)="ChangeFiltro(true)">
              <input name="radio" type="radio">
              <span>Completada</span>
            </label>

            <label class="radio" *ngIf="clicked" (click)="ChangeFiltro(false)">
              <input name="radio" type="radio">
              <span>No Completada</span>
            </label>

          </div>
        </div>


        <table class="table">
          <thead>
            <tr class="filters text-center">
              <th>
                <div class="input-group" *ngIf="clicked">

                  <input class="form-control" placeholder="dd/mm/yyyy"
                         name="dp" ngbDatepicker #dF="ngbDatepicker" id="fromDate">

                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" (click)="dF.toggle()" type="button">
                      <img src="assets/calendar.svg" style="width: 1.2rem; height: 1rem; cursor: pointer;" />
                    </button>

                  </div>
                </div>

                <input type="text" class="form-control" placeholder="Fecha" disabled *ngIf="!clicked">
                <!--input type="text" class="form-control" placeholder="Fecha" *ngIf="clicked" (ngModelChange)="TryHttpRequest()" [(ngModel)]="EvaluacionFiltrar.fecha"-->
              </th>
              <th>
                <input type="text" class="form-control" placeholder="Proyecto" disabled *ngIf="!clicked">
                <input type="text" class="form-control" placeholder="Proyecto" *ngIf="clicked" (ngModelChange)="TryHttpRequest()" [(ngModel)]="EvaluacionFiltrar.nombre">
              </th>
              <th>
                <input type="text" class="form-control" placeholder="Usuario" disabled *ngIf="!clicked">
                <input type="text" class="form-control" placeholder="Usuario" *ngIf="clicked" (ngModelChange)="TryHttpRequest()" [(ngModel)]="EvaluacionFiltrar.userNombre">
              </th>
              <th>
                <input type="text" class="form-control" placeholder="Puntuación" disabled *ngIf="!clicked">
                <input type="text" class="form-control" placeholder="Puntuación" pattern="[0-9]{3}" *ngIf="clicked" (ngModelChange)="TryHttpRequest()" [(ngModel)]="EvaluacionFiltrar.nrespuestas">
              </th>
              <th>
                <span>Estado</span>
              </th>
              <th>
                <span>Notas Evaluacion</span>
              </th>
              <th>
                <span>Notas Objetivos</span>
              </th>
              <th>
                <span>Informe</span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let evaluacion of ListaDeEvaluacionesPaginada; let i = index">
              <td>{{evaluacion.fecha | date:'dd/MM/yyyy, HH:mm'}}</td>
              <td>{{evaluacion.nombre}}</td>
              <td>{{evaluacion.userNombre}}</td>
              <td>{{evaluacion.puntuacion}}%</td>
              <td *ngIf="evaluacion.estado">Completada</td>
              <td *ngIf="!evaluacion.estado">No completada</td>
              <td>
                <button class="transparente" (click)="AbrirModal(notasEv, i, 0)">
                  <img *ngIf="evaluacion.notasEv != null" src="assets/nota_si.png" />
                  <img *ngIf="evaluacion.notasEv == null" src="assets/nota_no.png" />
                </button>
              </td>

              <td>
                <button class="transparente" (click)="AbrirModal(notasOb, i, 1)">
                  <img *ngIf="evaluacion.notasOb != null" src="assets/nota_si.png" />
                  <img *ngIf="evaluacion.notasOb == null" src="assets/nota_no.png" />
                </button>
              </td>

              <td><button type="button" class="btnpdf" (click)="SaveDataToPDF(evaluacion)">Ver Informe</button></td>
            </tr>
            <tr *ngIf="Mostrar && ListaDeEvaluacionesPaginada.length == 0">
              <td colspan="6">
                <h2 class="Warning">
                  No se encontraron datos.
                </h2>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="wrapper" *ngIf="NumMax > 1">
      <button type="button" class="btn btn-outline-success" (click)="NextPreviousButton(false)">Anterior</button>
      <strong>
        {{PageNow}}/{{NumMax}}
      </strong>
      <button type="button" class="btn btn-outline-success" (click)="NextPreviousButton(true)">Siguiente</button>
    </div>
  </div>

  <div class="wrapper mt-2">
    <button type="button" class="btn btn-info" (click)="VolverInicio()">Volver</button>
  </div>

</div>


<ng-template #notasEv let-cl="close" let-di="dismiss">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Notas Evaluación</h5> <button type="button" class="close" (click)="cl('Cerrar')">
        <span aria-hidden="true">×</span>
      </button>
    </div>
    <div class="modal-body">
      <textarea class="form-control" maxlength="1000" placeholder="Inserte aquí el texto" rows="10" [(ngModel)]="textoModal"></textarea>
    </div>
    <div class="modal-footer">
      <p id="numletras" class="mr-2 mt-2">{{textoModal.length}}/1000</p>
      <button type="button" class="btn btn-success" (click)="di('Guardar')">Guardar</button>
      <button type="button" class="btn btn-secondary" (click)="cl('Cerrar')">Cancelar</button>
    </div>
  </div>
</ng-template>

<ng-template #notasOb let-cl="close" let-di="dismiss">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Notas Objetivos</h5> <button type="button" class="close" (click)="cl('Cerrar')">
        <span aria-hidden="true">×</span>
      </button>
    </div>
    <div class="modal-body">
      <textarea class="form-control" maxlength="1000" placeholder="Inserte aquí el texto" rows="10" [(ngModel)]="textoModal"></textarea>
    </div>
    <div class="modal-footer">
      <p id="numletras" class="mr-2 mt-2">{{textoModal.length}}/1000</p>
      <button type="button" class="btn btn-success" (click)="di('Guardar')">Guardar</button>
      <button type="button" class="btn btn-secondary" (click)="cl('Cerrar')">Cancelar</button>
    </div>
  </div>
</ng-template>
